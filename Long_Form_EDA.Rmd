---
title: "NBA Season Statistics - Exploratory Data Analysis"
author: "Albert Li"
output: pdf_document
---
<br><br>

## Loading necessary libraries

<br><br>
```{r}
library(tidyverse)
```
<br><br><br>

## Loading in tables downloaded from the internet

<br><br>

```{r}
#read in basketball statistics for players
Seasons_Stats <- read_csv("Data/Processed/Seasons_Stats.csv")

#read in player info
Players <- read_csv("Data/Processed/Players.csv")
```

The above data frames were downloaded at https://www.kaggle.com/drgilermo/nba-players-stats/data .

Seasons_Stats includes all players who have played since 1950 and their statistics from each season played. Players gives us more background information about all the different players who have played in the NBA.
<br><br><br>

## Free throws attempted and personal fouls committed

<br><br>
The National Basketball Association (NBA) has seen its changes throughout the years. Many spectators believe that the current era is much less physical compared to before. To measure this, we will be taking a look at free throws attempted and personal fouls committed. First, we took a look at how many personal fouls were called and how many free throws were attempted each NBA season.
<br><br>
```{r}
#total fouls each year
#teams played 82 games starting in 1966
Seasons_Stats %>%
  group_by(Year) %>%
  filter(Year > 1966) %>%
  summarize(tot_pf = sum(PF)) %>%
  ggplot(mapping = aes(x = Year, y = tot_pf)) +
  geom_point() +
  geom_smooth()

#total fta each year
Seasons_Stats %>%
  group_by(Year) %>%
  summarize(tot_fta = sum(FTA)) %>%
  ggplot(mapping = aes(x = Year, y = tot_fta)) +
  geom_point() +
  geom_smooth()
```
<br><br>
What we find is the total number of free throws attempted has increased and the total number of personal fouls has also increased. What's surprising is that there is a dramatic jump in free throws attempted and personal fouls between the 1950s and 1980s. After doing more research, we found that early on, there were less NBA teams and less games being played. To account for this, we decided to take the total number of fouls and free throws in a season and divide it by the total number of games played that season. This would give us the the average number of personal fouls called and free throws attempted in a typical game that season. Using Excel, we created the csv file called Games. By using information online, we calculated the total number of NBA games played in each season. After joining the Games dataframe to Seasons_Stats, we can show the average fouls called per game and free throws attempted.
<br><br>
```{r}
#read in total games played each season
Games <- read_csv("Data/Processed/Games.csv")

#average free throws attempted per game (total number of games played in a season)
Seasons_Stats %>%
  group_by(Year) %>%
  summarize(tot_FTA = sum(FTA)) %>%
  left_join(Games, by = "Year") %>%
  mutate(FTA_per_game = tot_FTA / tot_games) %>%
  ggplot(mapping = aes(x = Year, y = FTA_per_game)) +
  geom_point() +
  geom_smooth()

#average personal fouls called per game (total number of games played in a season)
Seasons_Stats %>%
  group_by(Year) %>%
  summarize(tot_PF = sum(PF)) %>%
  left_join(Games, by = "Year") %>%
  mutate(PF_per_game = tot_PF / tot_games) %>%
  ggplot(mapping = aes(x = Year, y = PF_per_game)) +
  geom_point() +
  geom_smooth()
```
<br><br>
By looking at the averages, we actually observe that the average number of personal fouls and free throws attempted each game in a season decreases as time progresses. This is particularly interesting because some may claim that back then, more physicality led to less fouls being called and the referees allowing the players to play with less restrictions. This certainly is not the case with average number of fouls being called per game and free throws attempted per game both trending downwards. One possible explanation could be that the NBA could be implementing rule changes (banning hand checking) or calling more flagrant fouls, preventing defenders from playing aggressively. As the defenders play less aggressively, less fouls would be called, and as a result, less free throws would be attempted.
<br><br><br>

## Implementation of 3-Pt Line

<br><br>
Spectators and analysts have also noted that NBA players are now shooting more three pointers than ever, not just the shooting guards. But the three point line has not always been in existence. It wasn't until the 1979-1980 season when the NBA first implemented the three point line. We wanted to see how the NBA players adjusted to this change. First we took a look at the average number of three point shots attempted in a typical game.
<br><br>
```{r}
#converting character column to numeric column
Seasons_Stats$`3PA` <- as.numeric(as.character(Seasons_Stats$`3PA`))
Seasons_Stats$`3P` <- as.numeric(as.character(Seasons_Stats$`3P`))

#three pointers attempted, for all players
Seasons_Stats %>%
  filter(Year > 1979) %>%
  group_by(Year) %>% 
  summarize(tot_3PA = sum(`3PA`)) %>%
  left_join(Games, by = "Year") %>%
  mutate(`3PA_per_game` = tot_3PA / tot_games) %>%
  ggplot(mapping = aes(x = Year, y = `3PA_per_game`)) +
  geom_point() +
  geom_smooth()
```
<br><br>
We see a clear upward trend in the number of three pointers attempted in an NBA game over the years. There is also no sign of the number of attempts plateauing, suggesting that the number of attempts will likely continue to increase the next several seasons. Now, let's take a look at the number of attempts by player position, using a function.
<br><br>
```{r}
#by position
avg3PA_pos <- function(position) {
  Seasons_Stats %>%
    filter(Year > 1979) %>%
    filter(Pos == position) %>%
    group_by(Year) %>% 
    summarize(tot_3PA = sum(`3PA`)) %>%
    left_join(Games, by = "Year") %>%
    mutate(`3PA_per_game` = tot_3PA / tot_games) %>%
    ggplot(mapping = aes(x = Year, y = `3PA_per_game`)) +
    geom_point() +
    geom_smooth()
}
  
avg3PA_pos("C")
avg3PA_pos("PF")
avg3PA_pos("SF")
avg3PA_pos("SG")
avg3PA_pos("PG")
```
<br><br>
Traditionally, Centers and Power Forwards tend to do less shooting as they were mostly situated around the paint area. But by looking at the number of three point attempts they are taking over the years, it seems that they are moving outwards and more willing to shoot from beyond the arc. What's especially interesting is that Centers have only started shooting more threes in recent years, with a large jump between the 2016 and 2017 season.
<br><br>
Next, we wanted to see how accurate players were shooting the three point shot. We first took a look at how the players' three point field goal percentage has changed over the seasons. To calculate this, we divided the total number of three point makes by the total number of three point attempts each season.
<br><br>
```{r}
#all players
Seasons_Stats %>%
  filter(Year > 1979) %>%
  group_by(Year) %>% 
  summarize(tot_3PA = sum(`3PA`),
            tot_3PM = sum(`3P`)) %>%
  left_join(Games, by = "Year") %>%
  mutate(`3P%` = tot_3PM / tot_3PA) %>%
  ggplot(mapping = aes(x = Year, y = `3P%`)) +
  geom_point() +
  geom_smooth()
```
<br><br>
From the plot above, we can see that initially, players shot the three point shot at a relatively inaccurate percentage. By as time went on, players began to adjust and their three point percentage increased and plateaued by the mid 1990's. Ever since then, the league average hovers between 34% and 36%. Despite the players shooting the three ball more than ever before, their three point field goal percentage has been relatively the same since the mid 1990's. Now, let's take a look at how accurately players from each position shoots the three point shot.
<br><br>
```{r}
#by position
threepointperc <- function(position) {
  Seasons_Stats %>%
    filter(Year > 1979) %>%
    filter(Pos == position) %>%
    group_by(Year) %>% 
    summarize(tot_3PA = sum(`3PA`),
              tot_3PM = sum(`3P`)) %>%
    left_join(Games, by = "Year") %>%
    mutate(`3P%` = tot_3PM / tot_3PA) %>%
    ggplot(mapping = aes(x = Year, y = `3P%`)) +
    geom_point() +
    geom_smooth()
}

threepointperc("C")
threepointperc("PF")
threepointperc("SF")
threepointperc("SG")
threepointperc("PG")

```
<br><br>
We observe a similar pattern from each of the positions, with the exception of the Center position. Point Guards, Shooting Guards, Small Forwards, and Power Forwards have all initially increased their three point shooting percentage and have plateaued around the mid 1990's. They all have plateaued at around the 35% to 37% mark. The Center position is the only position whose three point percentage is still trending upwards towards the 35% mark.
<br><br><br>

## Which colleges produced the best basketball players?

<br><br>
Certain colleges dominate the scene in the NCAA on a yearly basis, such as Duke and Kentucky. But do these schools hone players' talent that translate to the NBA level? To measure how good a NBA players is, we first decided to measure their Player Efficiency Rating (PER). We decided to take the median PER for players who went to each college that was recorded in the Players dataframe.
<br><br>
```{r}
#PER

#median PER
PER_stats <- Seasons_Stats %>%
  left_join(Players, by = "Player") %>%
  group_by(collage) %>%
  summarize(med_PER = median(PER, na.rm = TRUE)) %>%
  arrange(desc(med_PER))

PER_stats
```
<br><br>
What we find is a bit troubling, as many of these top colleges are not very well-known. A possible cause for this phenomenon is that only one or two really good NBA players have come from these colleges. To counter this effect, we decided to weight the median PER by the proportion of NBA seasons accounted for by a college. This means that colleges that produce more NBA talent will have their weighted PER to be more significant.
<br><br>
```{r}
#total number of player seasons
count(Seasons_Stats)
#24691

#find proportion of seasons from each college
prop_seasons <- Seasons_Stats %>%
  left_join(Players, by = "Player") %>%
  group_by(collage) %>%
  count() %>%
  mutate(prop_seasons = n /24691)

#join back to average PER, weighted top colleges
PER_stats %>%
  left_join(prop_seasons, by = "collage") %>%
  mutate(wPER = med_PER * prop_seasons) %>%
  arrange(desc(wPER))
```
<br><br>
After weighting the PER, now we see a more accurate representation of the colleges that produced the best NBA talent. Now let's see what are the best colleges measured by the players' Win Shares.
<br><br>
```{r}
#win shares

#median win shares
WS_stats <- Seasons_Stats %>%
  left_join(Players, by = "Player") %>%
  group_by(collage) %>%
  summarize(med_WS = median(WS, na.rm = TRUE)) %>%
  arrange(desc(med_WS))

#weighted win shares
WS_stats %>%
  left_join(prop_seasons, by = "collage") %>%
  mutate(wWS = med_WS * prop_seasons) %>%
  arrange(desc(wWS))
```
<br><br>
When ranking by weighted win shares, we see almost the same colleges when ranking by weighted PER. One thing to note is that many players either came to the NBA straight out of high school or did not have their college recorded in the Players dataframe. This is why we see NA as the top result.
